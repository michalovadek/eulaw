---
title: "Legislative Output of the European Union"
subtitle: "An Automatically Updated Overview of the EU's Legislative Activity"
author: Dr Michal Ov√°dek
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    highlight: tango
---

<style>
body {
text-align: justify}
</style>

<style type="text/css">
  body{
  font-size: 13pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      error = FALSE)
```


```{r data, include=FALSE}

# packages
library(eurlex)
library(ggplot2)
library(dplyr)
library(stringr)
library(rmarkdown)
library(modelsummary)

# acts
acts_proposals <- elx_make_query("any", sector = 3,
                           include_date = TRUE,
                           include_proposal = TRUE) |>
  elx_run_query() |> 
  select(-work) |> 
  rename(date = `callret-3`)

# acts only
acts <- acts_proposals |> 
  filter(!is.na(celex)) |> 
  distinct(celex, .keep_all = T) |> 
  select(-proposal)

# 4 main types of acts
regs <- acts |> filter(str_sub(celex,6,6) == "R")
decs <- acts |> filter(str_sub(celex,6,6) == "D")
dirs <- acts |> filter(str_sub(celex,6,6) == "L")
recs <- acts |> filter(str_sub(celex,6,6) == "H")

# proposals
proposals <- elx_make_query("proposal", include_date = TRUE) |> 
  elx_run_query() |> 
  select(-work,-type) |> 
  rename(date_proposal = `callret-3`) |> 
  filter(!is.na(celex),
         !is.na(date_proposal)) |> 
  distinct(celex, .keep_all = TRUE)

# current date
date_now <- Sys.Date()
```

The European Union (EU) is often criticized for a heavy regulatory touch. What is the reality? This automatically updated research document gives a real-time overview of the EU's legislative output.

As of ```r format(Sys.time(), '%d %B %Y')```, the EU and its predecessors have produced ```r nrow(regs)``` regulations, ```r nrow(dirs)``` directives, ```r nrow(decs)``` decisions and ```r nrow(recs)``` recommendations, according to [Eur-Lex](https://eur-lex.europa.eu/homepage.html) data pulled via the [eurlex](https://github.com/michalovadek/eurlex) package for R and a SPARQL API maintained by the Publications Office of the European Union.

## Number of acts over time

We start by looking at how the number of the four main legal acts changed over the lifespan of the EU.

```{r ncounttime}

relevant_acts <- bind_rows(Regulation = regs, Decison = decs, Directive = dirs, Recommendation = recs,
                        .id = "type") |> 
  mutate(year = as.integer(str_sub(celex, 2,5))) |> 
  mutate(month_year = as.Date(str_replace(date, "[:digit:][:digit:]$", "01")))

n_relevant <- relevant_acts |> 
  count(year, type)

ggplot(n_relevant, aes(x = year, y = n, fill = type, color = type)) +
  geom_col(show.legend = FALSE) +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~type, scale = "free_y") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_line(color = "grey95"),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  labs(x = NULL,
       y = "Number of acts",
       title = "Number of legal acts produced by the European Union",
       subtitle = "Aggregated at the year level by date of publication")

```

## Proportion of act types

So we see there is significant over-time variation in the use of the different types of legal acts, but some types of acts, notably regulations, have been historically significantly more common than other types of acts. We can visualize the evolution of proportions directly:

```{r proptime}

expand.grid(year = min(n_relevant$year):max(n_relevant$year),
            type = unique(n_relevant$type)) |> 
  left_join(n_relevant) |> 
  mutate(n = ifelse(is.na(n), 0L, n)) |> 
  group_by(year) |> 
  mutate(total_y = sum(n),
         proportion = n/total_y) |> 
  ungroup() |> 
  ggplot(aes(x = year, y = proportion, fill = type, color = type)) +
  geom_area(show.legend = TRUE) +
  geom_vline(xintercept = c(1960,1980,2000,2020), lty = 2, color = "grey70") +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = NULL,
       y = NULL,
       title = "Proportion of each type of legal act by year")

```

Etc..

## Year-on-year comparison

How does the current state of the EU's legislative output compare to previous years?

```{r recentactivity}

# monthly output last two years
last_two_years <- relevant_acts |> 
  mutate(year = as.integer(str_sub(date, 1,4))) |> 
  filter(year %in% c(max(relevant_acts$year), max(relevant_acts$year)-1)) |> 
  count(month_year, type)

last_two_years_full <- expand.grid(month_year = unique(last_two_years$month_year),
            type = unique(last_two_years$type)) |> 
  left_join(last_two_years) |> 
  mutate(n = ifelse(is.na(n), 0L, n))

# year on year change
last_two_yoy_diff <- last_two_years_full |> 
  arrange(month_year) |> 
  mutate(month = str_sub(month_year, 6,7)) |> 
  group_by(month, type) |> 
  summarise(yoy_diff = diff(n)) |> 
  ungroup()

# viz
last_two_yoy_diff |> 
  ggplot(aes(x = month, y = yoy_diff, fill = type, color = type)) +
  geom_col(show.legend = FALSE) +
  geom_hline(yintercept = 0, color = "grey83", lty = 1) +
  facet_wrap(~type, scales = "free_y") +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  labs(x = "Month", y = "Year-on-year difference",
       title = "Monthly year-on-year comparison",
       subtitle = "Difference in the number of acts adopted this year compared to last year")

```

## Legislative efficiency {.tabset}

How long does it take for EU legislation to be adopted?

Hypothesis: enlargement leads to slower adoption processes due to increasing the number of players

### Plot

```{r efficiencyviz}

# calculate maximum length of adoption and discard negative
acts_days <- acts_proposals |> 
  filter(!is.na(celex),
         !is.na(date),
         !is.na(proposal)) |> 
  left_join(proposals, by = c("proposal"="celex")) |> 
  mutate(days = as.integer(as.Date(date) - as.Date(date_proposal))) |> 
  filter(days > -1) |> 
  group_by(celex) |> 
  filter(days == max(days)) |> 
  ungroup() |> 
  distinct(celex, .keep_all = TRUE) |> 
  arrange(date) |> 
  mutate(year_adopted = as.integer(str_sub(date, 1, 4)),
         type = str_sub(celex, 6, 6),
         type = case_when(type == "R" ~ "Regulation",
                          type == "L" ~ "Directive",
                          type == "D" ~ "Decision",
                          T ~ "Other"),
         five_year = cut_interval(year_adopted, length = 5)) |> 
  filter(year_adopted > 1985) # not many complete pairs before this

# identify outliers
outliers <- acts_days |> 
  group_by(type) |> 
  mutate(max = max(days),
         mean = mean(days),
         coef = days / mean) |> 
  filter(coef > 3)

# plot
acts_days |> 
  filter(!celex %in% outliers$celex) |> 
  group_by(type) |> 
  mutate(global_mean = mean(days)) |> 
  ggplot(aes(x = five_year, y = days, color = type, fill = type)) +
  geom_boxplot(alpha = 0.1) +
  #geom_violin(trim = TRUE, alpha = 0.1, draw_quantiles = c(0.5)) +
  geom_hline(aes(yintercept = global_mean), lty = 2, color = "grey70") +
  facet_wrap(~type, dir = "h", ncol = 1, scales = "free_y") +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        plot.caption = element_text(face = "italic", size = 8),
        strip.text = element_text(hjust = 0, face = "bold")) +
  labs(x = NULL,
       y = "Days to adoption",
       title = "Number of days between proposal and adoption",
       subtitle = "By five-year window in which the act was adopted*",
       caption = "* Outliers are pruned from the analysis, dashed line shows the global mean")

```

### Code

```{r efficiencyviz, echo=TRUE, eval=FALSE}
```

## {-}

Directives take by far the longest to adopt; unlike decisions and regulations, they are rarely deployed to regulate trivial matters. Nonetheless, there are few easily discernible temporal patterns in the plot. Most of all, it is not obvious that legislative efficiency would decrease as the EU expanded its membership.

To investigate this claim further, let's move from visual inspection to regression analysis.

### Plot

```{r regression}

# number of member states over time
ms_years <- bind_rows(
  data.frame(
    year = 1952:1972,
    n_ms = 6
  ),
  data.frame(
    year = 1973:1980,
    n_ms = 9
  ),
  data.frame(
    year = 1981:1985,
    n_ms = 10
  ),
  data.frame(
    year = 1986:1994,
    n_ms = 12
  ),
  data.frame(
    year = 1995:2004,
    n_ms = 15
  ),
  data.frame(
    year = 2005:2006,
    n_ms = 25
  ),
  data.frame(
    year = 2007:2013,
    n_ms = 27
  ),
  data.frame(
    year = 2014:2018,
    n_ms = 28
  ),
  data.frame(
    year = 2019:2025,
    n_ms = 27
  )
)

# append N member states
days_ms <- acts_days |> 
  left_join(ms_years, by = c("year_adopted"="year")) |> 
  mutate(type = relevel(as.factor(type), ref = "Other"))

# regress
models <- list()

## m0
models[['Baseline']] <- lm(
  data = days_ms,
  formula = days ~ n_ms
)
names(models[['Baseline']]$coefficients)[1] <- "Constant"

## m1
models[['Controls']] <- lm(
  data = days_ms,
  formula = days ~ n_ms + type
)
names(models[['Controls']]$coefficients)[1] <- "Act type = Other"

## m2
models[['Zero Intercept']] <- lm(
  data = days_ms,
  formula = days ~ n_ms + type + 0
)

# effect size
effect <- as.numeric(round(models[['Controls']]$coefficients[which(names(models[['Controls']]$coefficients) == "n_ms")],2))

# summary for p values
mod_sum <- summary(models[['Controls']])

# p value
p_value <- mod_sum$coefficient[names(mod_sum$coefficient[,1]) == "n_ms",4]

# p threshold
p_thresh <- 0.05

# can we reject the null
reject_null <- ifelse(effect > 0 & p_value < p_thresh, "can reject", "cannot reject")

# show table
modelsummary(models, 
             stars = TRUE,
             coef_map = c("n_ms" = "Number of Member States",
                          "Constant" = "Constant",
                          "typeOther" = "Act type = Other",
                          "Act type = Other" = "Act type = Other",
                          "typeRegulation" = "Act type = Regulation",
                          "typeDecision" = "Act type = Decision",
                          "typeDirective" = "Act type = Directive"),
             title = "Linear regression model of legislative efficiency (Y_i = days)",
             notes = list("In the 'Controls' specification, 'Other' is the reference category."))

```

### Code

```{r regression, echo=TRUE, eval=FALSE}
```

## {-}

Controlling for the type of act, the simple linear model predicts that for every additional Member State, the EU takes ```r effect``` days longer to adopt the legal act. This model is far too simple to establish the existence of a causal relationship between the number of Member States and legislative efficiency. Indeed, some scholars would argue that no amount of conditioning on observables is sufficient to establish causality. Nonetheless, our simple analysis suggests that we ```r reject_null``` the null hypothesis that more Member States in the EU system are associated with slower law-making. 
