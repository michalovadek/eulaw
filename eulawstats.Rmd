---
title: "Legislative Output of the European Union"
subtitle: "An Automatically Updated Overview of the EU's Legislative Activity"
author: Michal Ov√°dek
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    highlight: tango
---

<style>
body {
text-align: justify}
</style>

<style type="text/css">
  body{
  font-size: 13pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      error = FALSE)
```


```{r, include=FALSE}
library(eurlex)
library(ggplot2)
library(dplyr)
library(stringr)
library(rmarkdown)

acts <- elx_make_query("any", sector = 3,
                       include_date = TRUE) |>
  elx_run_query() |> 
  select(-work) |> 
  rename(date = `callret-3`)

regs <- acts |> filter(str_sub(celex,6,6) == "R")
decs <- acts |> filter(str_sub(celex,6,6) == "D")
dirs <- acts |> filter(str_sub(celex,6,6) == "L")
recs <- acts |> filter(str_sub(celex,6,6) == "H")

# current date
date_now <- Sys.Date()
```

The European Union (EU) is often criticized for a heavy regulatory touch. What is the reality? This automatically updated research document gives a real-time overview of the EU's legislative output.

As of ```r format(Sys.time(), '%d %B %Y')```, the EU and its predecessors have produced ```r nrow(regs)``` regulations, ```r nrow(dirs)``` directives, ```r nrow(decs)``` decisions and ```r nrow(recs)``` recommendations, according to [Eur-Lex](https://eur-lex.europa.eu/homepage.html) data pulled via the [eurlex](https://github.com/michalovadek/eurlex) package for R and a SPARQL API maintained by the Publications Office of the European Union.

## Number of acts over time

Here is how the number of the four main legal acts changed over the lifespan of the EU.

```{r counttime}

relevant_acts <- bind_rows(Regulation = regs, Decison = decs, Directive = dirs, Recommendation = recs,
                        .id = "type") |> 
  mutate(year = as.integer(str_sub(celex, 2,5))) |> 
  mutate(month_year = as.Date(str_replace(date, "[:digit:][:digit:]$", "01")))

n_relevant <- relevant_acts |> 
  count(year, type)

ggplot(n_relevant, aes(x = year, y = n, fill = type, color = type)) +
  geom_col(show.legend = FALSE) +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  facet_wrap(~type, scale = "free_y") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_line(color = "grey95"),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  labs(x = NULL,
       y = "Number of acts",
       title = "Number of legal acts produced by the European Union",
       subtitle = "Aggregated at the year level by date of publication")

```

## Proportion of act types over time

So we see there is significant over-time variation in the use of the different types of legal acts, but some types of acts, notably regulations, have been historically significantly more common than other types of acts. We can visualize the evolution of proportions directly:

```{r proptime}

expand.grid(year = min(n_relevant$year):max(n_relevant$year),
            type = unique(n_relevant$type)) |> 
  left_join(n_relevant) |> 
  mutate(n = ifelse(is.na(n), 0L, n)) |> 
  group_by(year) |> 
  mutate(total_y = sum(n),
         proportion = n/total_y) |> 
  ungroup() |> 
  ggplot(aes(x = year, y = proportion, fill = type, color = type)) +
  geom_area(show.legend = TRUE) +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = NULL,
       y = NULL,
       title = "Proportion of each type of legal act by year")

```

Etc..

## Year-on-year comparison

How does the current state of the EU's legislative output compare to previous years?

```{r recentactivity}

# monthly output last two years
last_two_years <- relevant_acts |> 
  mutate(year = as.integer(str_sub(date, 1,4))) |> 
  filter(year %in% c(max(relevant_acts$year), max(relevant_acts$year)-1)) |> 
  count(month_year, type)

last_two_years_full <- expand.grid(month_year = unique(last_two_years$month_year),
            type = unique(last_two_years$type)) |> 
  left_join(last_two_years) |> 
  mutate(n = ifelse(is.na(n), 0L, n))

# year on year change
last_two_yoy_diff <- last_two_years_full |> 
  arrange(month_year) |> 
  mutate(month = str_sub(month_year, 6,7)) |> 
  group_by(month, type) |> 
  summarise(yoy_diff = diff(n)) |> 
  ungroup()

last_two_yoy_diff |> 
  ggplot(aes(x = month, y = yoy_diff, fill = type, color = type)) +
  geom_col(show.legend = FALSE) +
  geom_hline(yintercept = 0, color = "grey83", lty = 1) +
  facet_wrap(~type, scales = "free_y") +
  scale_fill_brewer(palette = "Spectral") +
  scale_color_brewer(palette = "Spectral") +
  theme_minimal() +
  theme(legend.position = "top",
        legend.justification = "left",
        legend.title = element_text(face = "italic"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_blank(),
        axis.text = element_text(color = "grey10"),
        title = element_text(face = "bold"),
        strip.text = element_text(hjust = 0, face = "bold")) +
  labs(x = "Month", y = "Year-on-year difference",
       title = "Monthly year-on-year comparison",
       subtitle = "Difference in the number of acts adopted this year compared to last year")
  

```

A

